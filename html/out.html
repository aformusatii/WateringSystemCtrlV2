<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"name=viewport><title>Dynamic Channel Controls</title><style>body{font-family:Arial,sans-serif;margin:20px}.channel-panel{border:1px solid #ccc;padding:10px;margin-bottom:20px;background-color:#eee}.channel-header{display:flex;align-items:center}.channel-header .channel-label{padding:5px 10px;border:1px solid #ccc;background:#f0f0f0;margin-right:5px}.channel-header .channel-name-input{flex:1;padding:5px;font-size:1em;border:1px solid #ccc;margin-right:5px}.mode-selector{margin-top:10px;display:flex}.mode-button{border:1px solid #ccc;background:#fff;padding:5px 10px;margin-right:-1px;cursor:pointer}.mode-button.active{background:#d0e7ff}.scheduler-settings,.timer-settings{margin-top:10px}.timer-settings label{display:block;margin-bottom:5px}.timer-settings input{margin-left:5px}.scheduler-row{display:flex;align-items:center;margin-bottom:5px}.scheduler-row .slot-label{margin-right:10px}.scheduler-row label{margin-right:10px;font-size:.9em}.scheduler-row input{width:70px;margin-right:10px}.scheduler-settings input[readonly]{background:#eee;border:1px solid #ccc}.footer-buttons{text-align:right}.footer-buttons button{margin-left:10px;padding:5px 15px}</style><div id=channels-container></div><div class=footer-buttons><button onclick=saveChannelsData() id=save-button>Save</button></div><div class=section><h2>DS3231</h2><div id=DS3231-container>Loading...</div><button onclick=refreshDS3231() class="btn fr"type=button>Refresh</button><button onclick=updateDS3231() class="btn fr mr-5"type=button>Update Time</button><div class=clrfix></div></div><script>const modes=[{key:4,name:"Off"},{key:3,name:"Manual"},{key:2,name:"Timer"},{key:1,name:"Scheduler"}],modeMap=modes.reduce(((e,t)=>(e[t.key]=t.name.toLowerCase(),e)),{});let channels=[],ds3231Data={};async function buildChannels(){const e=document.getElementById("channels-container");channels.forEach(((t,n)=>{const a=n+1,s=document.createElement("div");s.className="channel-panel",s.id=`channel-${a}`;const c=document.createElement("div");c.className="channel-header";const d=document.createElement("span");d.className="channel-label",d.textContent=`CH ${a}`,c.appendChild(d);const o=document.createElement("input");o.type="text",o.className="channel-name-input",o.id=`channel${a}-name`,o.value=t.name,o.dataset.channel=a,o.addEventListener("change",(e=>{const t=e.target.dataset.channel-1;channels[t].name=e.target.value})),c.appendChild(o),s.appendChild(c);const l=document.createElement("div");l.className="mode-selector",modes.forEach(((e,n)=>{const s=document.createElement("button");s.textContent=e.name,s.className="mode-button",s.dataset.channel=a,s.dataset.mode=e.key,t.mode===e.key&&s.classList.add("active"),l.appendChild(s)})),s.appendChild(l);const r=document.createElement("div");r.className="timer-settings",r.id=`channel${a}-timer`,"timer"!==modeMap[t.mode]&&(r.style.display="none"),["onDurationMs","offDurationMs"].forEach((e=>{const n=document.createElement("label");n.textContent="onDurationMs"===e?"On Period (ms):":"Off Period (ms):";const s=document.createElement("input");s.type="number",s.min="0",s.id=`channel${a}-${e}`,s.value=t.timer[e],s.dataset.channel=a,s.addEventListener("change",(t=>{const n=t.target.dataset.channel-1;channels[n].timer[e]=parseInt(t.target.value)})),n.appendChild(s),r.appendChild(n)})),s.appendChild(r);const i=document.createElement("div");i.className="scheduler-settings",i.id=`channel${a}-scheduler`,"scheduler"!==modeMap[t.mode]&&(i.style.display="none"),t.schedules.forEach(((e,t)=>{const n=document.createElement("div");n.className="scheduler-row";const s=document.createElement("label");s.className="slot-label",s.textContent=`Slot ${t+1}:`,n.appendChild(s);const c=document.createElement("label");c.textContent="Start Time";const d=document.createElement("input");d.type="time",d.id=`channel${a}-slot${t+1}-start`,d.value=`${String(e.startHour).padStart(2,"0")}:${String(e.startMinute).padStart(2,"0")}`,d.dataset.channel=a,d.addEventListener("change",(e=>{const n=e.target.dataset.channel-1,[a,s]=e.target.value.split(":").map(Number);channels[n].schedules[t].startHour=a,channels[n].schedules[t].startMinute=s})),c.appendChild(d),n.appendChild(c);const o=document.createElement("label");o.textContent="Duration (min)";const l=document.createElement("input");l.type="number",l.min="0",l.id=`channel${a}-slot${t+1}-duration`,l.value=e.durationMin,l.dataset.channel=a,l.addEventListener("change",(e=>{const n=e.target.dataset.channel-1;channels[n].schedules[t].durationMin=parseInt(e.target.value)})),o.appendChild(l),n.appendChild(o);const r=document.createElement("label");r.textContent="End Time";const m=document.createElement("input");m.type="time",m.readOnly=!0,m.id=`channel${a}-slot${t+1}-end`,r.appendChild(m),n.appendChild(r),i.appendChild(n)})),s.appendChild(i),e.appendChild(s)})),document.querySelectorAll(".mode-button").forEach((e=>{e.addEventListener("click",(t=>{const n=e.dataset.channel,a=e.dataset.mode,s=t.target.dataset.channel-1;channels[s].mode=parseInt(t.target.dataset.mode),document.querySelectorAll(`#channel-${n} .mode-button.active`).forEach((e=>e.classList.remove("active"))),e.classList.add("active"),document.getElementById(`channel${n}-timer`).style.display="timer"===modeMap[a]?"block":"none",document.getElementById(`channel${n}-scheduler`).style.display="scheduler"===modeMap[a]?"block":"none"}))}));channels.forEach(((e,t)=>{const n=t+1;channels[t].schedules.forEach(((e,t)=>{const a=document.getElementById(`channel${n}-slot${t+1}-start`),s=document.getElementById(`channel${n}-slot${t+1}-duration`),c=document.getElementById(`channel${n}-slot${t+1}-end`),d=()=>c.value=((e,t)=>{const[n,a]=e.split(":").map(Number),s=60*n+a+parseInt(t,10);return`${String(Math.floor(s%1440/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`})(a.value,s.value);a.addEventListener("input",d),s.addEventListener("input",d),d()}))}))}function pad(e){return e<10?"0"+e:e}async function refreshDS3231(){await fetchDS3231Data(),buildDS3231()}function buildDS3231(){const e=document.getElementById("DS3231-container");e.innerHTML="";const t=`${pad(ds3231Data.hour)}:${pad(ds3231Data.minute)}:${pad(ds3231Data.second)} ${pad(ds3231Data.day)}/${pad(ds3231Data.month)}/${ds3231Data.year+2e3}`,n=document.createElement("div");n.className="ds3231-data",n.innerHTML=`\n                <p>Current Time: ${t}</p>\n                <p>Temperature: ${ds3231Data.temperature} Â°C</p>\n            `,e.appendChild(n)}async function updateDS3231(){const e=new Date;let t={};t.hour=e.getHours(),t.minute=e.getMinutes(),t.second=e.getSeconds(),t.year=e.getFullYear()-2e3,t.month=e.getMonth()+1,t.day=e.getDate(),t.second=e.getSeconds();const n=await fetch("DS3231.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)return void alert("Error updating DS3231 data: "+n.statusText);await n.json();alert("DS3231 data updated successfully!")}async function fetchDS3231Data(){try{const e=await fetch("channels.json");if(!e.ok)return void alert("Error fetching channels data: "+e.statusText);channels=await e.json();const t=await fetch("DS3231.json");if(!t.ok)return void alert("Error fetching DS3231 data: "+t.statusText);ds3231Data=await t.json()}catch(e){return void alert("Error fetching data: "+e.message)}}async function fetchChannels(){try{const e=await fetch("channels.json");if(!e.ok)return void alert("Error fetching channels data: "+e.statusText);channels=await e.json();const t=await fetch("DS3231.json");if(!t.ok)return void alert("Error fetching DS3231 data: "+t.statusText);ds3231Data=await t.json()}catch(e){return void alert("Error fetching data: "+e.message)}}async function saveChannelsData(){console.log("Saving data...",channels);const e=await fetch("channels.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(channels)});e.ok||alert("Error setting channel: "+e.statusText)}async function onPageLoad(){await fetchChannels(),await buildChannels(),await fetchDS3231Data(),buildDS3231()}document.addEventListener("DOMContentLoaded",(()=>{onPageLoad()}))</script>